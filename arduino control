#include <Servo.h>

Servo myServo;
const int chanDirX = 2;const int chanPulX = 3;
const int chanDirY = 4;const int chanPulY = 5;
const int chanDirZ = 7;const int chanPulZ = 6;
const int sensor1 = 8;const int sensor2 = 9;
const int servo = 10;
const int in3 = 11;const int in4 = 12;
const int ct1 = A5;const int ct2 = A4;

//Truc X
void quayThuanX(int steps, int pulseDelayUs) {
  digitalWrite(chanDirX, HIGH);
  delayMicroseconds(1);
  for (int i = 0; i < steps; i++) {
    digitalWrite(chanPulX, HIGH);
    delayMicroseconds(1);
    digitalWrite(chanPulX, LOW);
    delayMicroseconds(pulseDelayUs);
  }
}
void quayNghichX(int steps, int pulseDelayUs) {
  digitalWrite(chanDirX, LOW);
  delayMicroseconds(1);
  for (int i = 0; i < steps; i++) {
    digitalWrite(chanPulX, HIGH);
    delayMicroseconds(1);
    digitalWrite(chanPulX, LOW);
    delayMicroseconds(pulseDelayUs);
  }
}
void dungX() {
  digitalWrite(chanPulX, LOW);
}
//Trục Y
void quayThuanY(int steps, int pulseDelayUs) {
  digitalWrite(chanDirY, HIGH);
  delayMicroseconds(1);
  for (int i = 0; i < steps; i++) {
    digitalWrite(chanPulY, HIGH);
    delayMicroseconds(1);
    digitalWrite(chanPulY, LOW);
    delayMicroseconds(pulseDelayUs);
  }
}
void quayNghichY(int steps, int pulseDelayUs) {
  digitalWrite(chanDirY, LOW);
  delayMicroseconds(1);
  for (int i = 0; i < steps; i++) {
    digitalWrite(chanPulY, HIGH);
    delayMicroseconds(1);
    digitalWrite(chanPulY, LOW);
    delayMicroseconds(pulseDelayUs);
  }
}
void dungY() {
  digitalWrite(chanPulY, LOW);
}
//Trục Z
void quayThuanZ(int steps, int pulseDelayUs) {
  digitalWrite(chanDirZ, HIGH);
  delayMicroseconds(1);
  for (int i = 0; i < steps; i++) {
    digitalWrite(chanPulZ, HIGH);
    delayMicroseconds(1);
    digitalWrite(chanPulZ, LOW);
    delayMicroseconds(pulseDelayUs);
  }
}
void quayNghichZ(int steps, int pulseDelayUs) {
  digitalWrite(chanDirZ, LOW);
  delayMicroseconds(1);
  for (int i = 0; i < steps; i++) {
    digitalWrite(chanPulZ, HIGH);
    delayMicroseconds(1);
    digitalWrite(chanPulZ, LOW);
    delayMicroseconds(pulseDelayUs);
  }
}
void dungZ() {
  digitalWrite(chanPulZ, LOW);
}
//Bang tai
void bangTaiThuan() {
  digitalWrite(in3, HIGH);
  digitalWrite(in4, LOW);
}

void bangTaiNghich() {
  digitalWrite(in3, LOW);
  digitalWrite(in4, HIGH);
}

void bangTaiDung() {
  digitalWrite(in3, LOW);
  digitalWrite(in4, LOW);
}

//Set up
void setup(){
  pinMode(ct1, INPUT_PULLUP);//1 chân còn lại kéo xuống đất
  pinMode(ct2, INPUT_PULLUP);

  pinMode(sensor1, INPUT);
  pinMode(sensor2, INPUT);
  
  pinMode(chanDirX, OUTPUT);
  pinMode(chanPulX, OUTPUT);
  pinMode(chanDirY, OUTPUT);
  pinMode(chanPulY, OUTPUT);
  pinMode(chanDirZ, OUTPUT);
  pinMode(chanPulZ, OUTPUT);

  digitalWrite(chanPulX, LOW);
  digitalWrite(chanPulY, LOW);
  digitalWrite(chanPulZ, LOW);

  myServo.attach(servoPin);

  pinMode(in3, OUTPUT);
  pinMode(in4, OUTPUT);
  
}
//Loop
void loop(){
  int trang_thai_ct1 = digitalRead(ct1);
  int trang_thai_ct2 = digitalRead(ct2);

  int trang_thai_sensor1 = digitalRead(sensor1);
  int trang_thai_sensor2 = digitalRead(sensor2);

//Cam bien
if (trang_thai_sensor2 == LOW) {
  //
  }  
if (trang_thai_sensor1 == LOW) {
  //
  }
//Servo
  myServo.write(0);
  delay(1000);

  myServo.write(180);
  delay(2000); // Dung 2 giay tai vi tri 180 do

  myServo.write(0);
  delay(1000); // Cho 1 giay truoc khi lap lai chu trinh

//Set Home
  if (trang_thai_ct1 == LOW) {
    dungX();
    delay(100);
    quayNghichX(2,500);
    }
  if (trang_thai_ct2 == LOW) {
    dungY();
    delay(100);
    quayNghichY(2,500);
  }

}
